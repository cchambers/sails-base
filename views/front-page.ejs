
<div class="loaded-view<% if (data.single) { %> active<% } %>">
  <% if (data.single) { 
    entry = data.single;
    comments = data.single.comments;
    %>
    <%- include direct-entry-article %>
    <% } %>


  </div>

  <div class="front-page scroll-y entries">
    <div class="row">
      <% 
      function timeSince (date) {var seconds = Math.floor((new Date() - date) / 1000);var interval = Math.floor(seconds / 31536000);if (interval > 1) {return interval + " years";}interval = Math.floor(seconds / 2592000);if (interval > 1) {return interval + " months";}interval = Math.floor(seconds / 86400);if (interval > 1) {return interval + " days";}interval = Math.floor(seconds / 3600);if (interval > 1) {return interval + " hours";}interval = Math.floor(seconds / 60);if (interval > 1) {return interval + " minutes";}return Math.floor(seconds) + " seconds";}

      var active = "" 
      var entries = data.entries; 
      for (which in entries) { 
       var entry = entries[which]; 
       if (entry) { 
         if (entry.nsfw == true && user.hidensfw == true) { 
         } else { 
           if (entry.nsfl == true && user.hidensfl == true) { 
           } else { 
             var date = new Date(entry.createdAt);
             %>
             <article class="row entry <%= active %><% if (entry.oembed && entry.ombed != "") { %>has-media<% } %><% if (entry.sticky) { %> sticky<% } %>" data-timestamp="<%= date %>" data-id="<%= entry.id %>" id="<%= entry.id %>">
              <header>
                <h1>
                  <%= entry.title %>
                </h1>
              </header>
              <% if (entry.oembed && entry.ombed != "") { 
                var oembed = JSON.parse(entry.oembed);
                var thumb = oembed.thumbnail_url;
                if (thumb != "") {
                  %>
                  <div class="thumb" style="">
                    <div class="nail" style="background-image:url(<%= thumb %>)"></div>
                  </div>
                  <% }
                } %>
                <cite>
                  <strong><%= entry.postedBy.name %></strong> &rarr;
                  <% for (var x = 0; x < entry.subs.length; x++) { %>
                  <% if (x > 0) { %> / <% } %>
                  <a href="/sub/<%= entry.subs[x].slug %>/<%= entry.slug %>"><%= entry.subs[x].name %></a>
                  <% } %>
                  <span class="timesince"><%= timeSince(date) %> ago</span>
                </cite>
                <footer>
                  <div class="permalink">
                    <a href="/sub/<%= entry.subs[0].slug %>/<%= entry.slug %>#comments"><%= entry.commentCount %>&nbsp;comments</a>
                  </div>
                  <div class="score">
                    <span class="totes"><%= entry.getScore() %></span>
                    <span class="calculated"> &rarr; (<span class="ups"><%= entry.ups %></span> - <span class="downs"><%= entry.downs %></span>)</span>
                  </div>
                </footer>
                <ul class="tags">
                  <% if (entry.nsfw) { %><li>NSFW</li> <% } %>
                  <% if (entry.nsfl) { %><li>NSFL</li><% } %>
                  <% if (entry.media) { if (entry.media.indexOf('.gif') > 0){ %><li>GIF</li><% } } %>
                </ul>
              </article>
              <% } %>
              <% } %>
              <% } %>
              <% } %>
            </div>

          </div>

          <% if (data.images.length > 6 && data.videos.length > 5 && data.text.length > 10) { %>
          <div class="feature scroll-y">
            <div class="features">
              <div class="row">
                <div class="col-2-3">
                  <a href="#<%= data.images[0].id %>">
                    <div class="media primary" style="background-image:url(<%= data.images[0].media %>)" title="<%= data.images[0].title %>">
                    </div>
                  </a>
                </div>
                <div class="col-1-3">
                  <ul class="text-entries">
                    <% for (var x = 0; x < 10; x++) { %>
                    <li>
                      <a href="#<%= data.text[x].id %>"><%= data.text[x].title %></a>
                    </li>
                    <% } %>
                  </ul>
                </div>
              </div>
              <div class="row tertiary-media videos flex">
                <% for (var x = 1; x < 5; x++) { %>
                <% if (data.images[x]) { %>
                <div class="media image flex-item" style="background-image:url(<%= data.images[x].media %>)"> 
                  <a href="#<%= data.images[x].id %>"><%= data.images[x].title %></a>
                </div>
                <% } %>
                <% } %>
                <%
                for (var x = 0; x < 4; x++) { 
                  var media = data.videos[x].media
                  if(media.indexOf('youtu') > 0) {
                    var which = "" 
                    if (media.indexOf('watch?v') > 0) { 
                      which = media.split("=")[1] 
                    } else if (media.indexOf('youtu.be') > 0) { 
                      which = media.split("/").pop() 
                    } else if (media.indexOf('embed') > 0) { 
                      which = media.split("/").pop().split("?")[0] 
                    } 
                    if (which.indexOf('?') > 0) {
                      which = which.split('?')[0]
                    } 
                    if (which.indexOf('&') > -1) { 
                      which = which.split("&")[0] 
                    }  


                    if (which != "") { %> 
                    <div class="media flex-item" style="background-image:url(http://img.youtube.com/vi/<%= which %>/0.jpg)">
                      <a href="#<%= data.videos[x].id %>"><%= data.videos[x].title %></a>
                    </div>
                    <% }
                  }
                } %>

              </div>
            </div>
          </div>
          <% } else { %> 
          <div class="pad-light">
            Not enough data to feature.
          </div class="pad-light">
          <% } %> 

