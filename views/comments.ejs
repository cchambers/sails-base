<% if (typeof(user) != 'undefined') {  %>
<div class="row make-comment" id="make-comment">
  <div class="contain new-thing">
    <form method="POST" data-callback="output" action="/new/comment">
      <div class="row pad-bottom-light">
        <input type="text" name="slug" hidden value="<%= entries[which].slug %>">
        <input type="text" name="postedTo" hidden value="<%= entries[which].postedTo %>">
        <label for="title">Add a new comment</label>
        <textarea name="message"></textarea>
        <div class="row pad-bottom-light">
          <a class="button primary submit">send it</a>
        </div>
      </div>
    </form>
  </div>
</div>
<% } %>

<div class="row comments" id="comments">
  <div class="contain">
    <% if (entries[which].comments.length > 0) { %>
    <ul>
      <% for(i = 0; i < entries[which].comments.length; i++) {%>
      <li data-id="<%= entries[which].comments[i].id %>">
        <header>
          <%= entries[which].comments[i].postedBy.name %>
        </header>
        <section>
          <%= entries[which].comments[i].content %>
        </section>
        <footer class="new-thing">
          <a href="#" class="make-reply">reply</a>
          <a href="#" class="load-replies">load <%= entries[which].comments[i].children.length %> comments</a>
          <form class="off" method="POST" data-callback="output" action="/reply/<%= entries[which].comments[i].id %>">
            <div class="row pad-bottom-light">
              <textarea name="message" placeholder="reply..."></textarea>
            </div>
            <div class="row pad-bottom-light">
              <a class="button primary submit">send it</a>
              <output></output>
            </div>
          </form>
        </footer>
      </li>
      <% } %>
    </ul>
    <% } else { %>
      No comments yet!
    <% } %>
  </div>
</div>